<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IRON FORGE // STORE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Oswald:wght@400;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        :root{
            --brutal-black: #0a0a0a;
            --brutal-white: #f5f5f5;
            --brutal-accent: #ff3d00;
            --brutal-accent2: #00ff41;
            --brutal-accent3: #ffea00;
        }
        *{box-sizing:border-box}
        body{
            background:var(--brutal-black);
            color:var(--brutal-white);
            font-family:'Oswald',sans-serif;
            min-height:100vh;
            overflow-x:hidden;
            background-image:
                repeating-linear-gradient(0deg,transparent,transparent 1px,#1a1a1a 1px,#1a1a1a 2px),
                repeating-linear-gradient(90deg,transparent,transparent 1px,#1a1a1a 1px,#1a1a1a 2px);
            background-size:50px 50px
        }
        .brutal-title{
            font-family:'Bebas Neue',sans-serif;
            letter-spacing:0.15em;
            text-transform:uppercase;
            line-height:0.9
        }
        .brutal-mono{font-family:'Share Tech Mono',monospace}
        .brutal-border{
            border:4px solid var(--brutal-white);
            box-shadow:8px 8px 0 var(--brutal-accent)
        }
        .brutal-border-black{
            border:4px solid var(--brutal-black);
            box-shadow:6px 6px 0 var(--brutal-accent)
        }
        .brutal-btn{
            background:var(--brutal-accent);
            color:var(--brutal-black);
            font-family:'Bebas Neue',sans-serif;
            letter-spacing:0.1em;
            text-transform:uppercase;
            border:4px solid var(--brutal-black);
            box-shadow:6px 6px 0 var(--brutal-black);
            transition:all 0.1s;
            clip-path:polygon(0 0,100% 0,100% 85%,95% 100%,0 100%)
        }
        .brutal-btn:hover{
            transform:translate(-3px,-3px);
            box-shadow:9px 9px 0 var(--brutal-black);
            background:var(--brutal-accent3)
        }
        .brutal-btn:active{
            transform:translate(3px,3px);
            box-shadow:0 0 0 var(--brutal-black)
        }
        .brutal-btn-secondary{
            background:var(--brutal-white);
            color:var(--brutal-black)
        }
        .brutal-card{
            background:var(--brutal-white);
            color:var(--brutal-black);
            border:4px solid var(--brutal-black);
            clip-path:polygon(0 0,100% 0,100% 92%,95% 100%,0 100%);
            transition:all 0.15s
        }
        .brutal-card:hover{
            transform:translate(-4px,-4px);
            box-shadow:8px 8px 0 var(--brutal-accent)
        }
        .brutal-input{
            background:var(--brutal-white);
            border:3px solid var(--brutal-black);
            font-family:'Share Tech Mono',monospace;
            text-transform:uppercase;
            clip-path:polygon(0 0,100% 0,100% 85%,95% 100%,0 100%)
        }
        .brutal-input:focus{
            outline:none;
            border-color:var(--brutal-accent);
            box-shadow:4px 4px 0 var(--brutal-accent)
        }
        .brutal-accent-text{color:var(--brutal-accent)}
        .brutal-accent2-text{color:var(--brutal-accent2)}
        .brutal-accent3-text{color:var(--brutal-accent3)}
        .brutal-stripe{
            background:repeating-linear-gradient(
                45deg,
                var(--brutal-black),
                var(--brutal-black) 10px,
                var(--brutal-accent) 10px,
                var(--brutal-accent) 20px
            )
        }
        .brutal-noise{
            position:relative;
            overflow:hidden
        }
        .brutal-noise::after{
            content:'';
            position:absolute;
            top:0;left:0;right:0;bottom:0;
            background:url('data:image/svg+xml,<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><filter id="noise"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="4" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23noise)" opacity="0.1"/></svg>');
            pointer-events:none
        }
        .brutal-diagonal{
            clip-path:polygon(0 10%,100% 0,100% 90%,0 100%)
        }
        .brutal-skew{
            transform:skewX(-5deg)
        }
        .brutal-skew-content{
            transform:skewX(5deg)
        }
        .cart-overlay{animation:brutalFadeIn .2s steps(4)}
        .cart-modal{animation:brutalSlideIn .3s steps(6)}
        @keyframes brutalFadeIn{
            0%{opacity:0}
            25%{opacity:0.25}
            50%{opacity:0.5}
            75%{opacity:0.75}
            100%{opacity:1}
        }
        @keyframes brutalSlideIn{
            0%{transform:translateX(100%)}
            100%{transform:translateX(0)}
        }
        .brutal-success{animation:brutalPop .3s steps(4)}
        @keyframes brutalPop{
            0%{transform:scale(0.8);opacity:0}
            50%{transform:scale(1.1)}
            100%{transform:scale(1);opacity:1}
        }
        .brutal-glitch{
            position:relative
        }
        .brutal-glitch:hover::before,
        .brutal-glitch:hover::after{
            content:attr(data-text);
            position:absolute;
            left:0;
            top:0;
            width:100%;
            height:100%
        }
        .brutal-glitch:hover::before{
            left:2px;
            text-shadow:-2px 0 var(--brutal-accent);
            animation:glitch1 0.3s infinite
        }
        .brutal-glitch:hover::after{
            left:-2px;
            text-shadow:2px 0 var(--brutal-accent2);
            animation:glitch2 0.3s infinite
        }
        @keyframes glitch1{
            0%,100%{clip-path:inset(0 0 95% 0)}
            25%{clip-path:inset(30% 0 50% 0)}
            50%{clip-path:inset(70% 0 10% 0)}
            75%{clip-path:inset(10% 0 80% 0)}
        }
        @keyframes glitch2{
            0%,100%{clip-path:inset(95% 0 0 0)}
            25%{clip-path:inset(50% 0 30% 0)}
            50%{clip-path:inset(10% 0 70% 0)}
            75%{clip-path:inset(80% 0 10% 0)}
        }
        .brutal-barcode{
            background:repeating-linear-gradient(
                90deg,
                var(--brutal-black),
                var(--brutal-black) 2px,
                transparent 2px,
                transparent 4px
            )
        }
    </style>
</head>
<body x-data="happinessStore()">
    <!-- Brutal Header -->
    <header class="sticky top-0 z-50 bg-black border-b-4 border-white">
        <div class="brutal-stripe h-2"></div>
        <div class="max-w-7xl mx-auto px-4 py-6">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="text-center md:text-left">
                    <h1 class="brutal-title text-5xl md:text-7xl brutal-glitch" data-text="IRON FORGE">IRON FORGE</h1>
                    <p class="brutal-mono text-xs mt-1 tracking-widest brutal-accent-text">// DOMINATE YOUR LIMITS</p>
                </div>
                <button @click="showCart=!showCart" class="brutal-btn px-8 py-4 text-xl">
                    <span class="brutal-mono">[</span> CART <span x-text="cartItemCount"></span> <span class="brutal-mono">]</span>
                    <span class="block brutal-mono text-sm mt-1" x-text="cart.total"></span>₽
                </button>
            </div>
        </div>
        <div class="brutal-barcode h-1"></div>
    </header>

    <!-- Payment Success Modal -->
    <div x-show="paymentSuccess" class="fixed inset-0 bg-black/90 flex items-center justify-center z-[1000]" x-transition.opacity>
        <div class="bg-white border-4 border-black p-8 max-w-md text-center brutal-success" style="box-shadow:12px 12px 0 var(--brutal-accent2)">
            <div class="brutal-stripe h-4 -mx-8 -mt-8 mb-6"></div>
            <h2 class="brutal-title text-4xl brutal-accent2-text mb-4">ORDER CONFIRMED</h2>
            <div class="brutal-mono text-sm mb-4">
                <p>ORDER ID: <span class="brutal-accent-text" x-text="paymentSuccess.orderId"></span></p>
                <p>AMOUNT: <span class="brutal-accent-text" x-text="paymentSuccess.amount"></span>₽</p>
            </div>
            <p class="text-lg mb-6 font-bold">YOUR GEAR IS ON THE WAY</p>
            <button @click="paymentSuccess=null" class="brutal-btn brutal-btn-secondary px-8 py-3 text-xl w-full">CONTINUE SHOPPING</button>
            <div class="brutal-barcode h-1 -mx-8 -mb-8 mt-6"></div>
        </div>
    </div>

    <main class="max-w-7xl mx-auto px-4 py-8">
        <!-- Checkout Section -->
        <div x-show="showCheckout" x-transition class="max-w-2xl mx-auto">
            <div class="bg-white border-4 border-black" style="box-shadow:12px 12px 0 var(--brutal-accent)">
                <div class="brutal-stripe h-3"></div>
                <div class="p-6 md:p-8">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="brutal-title text-4xl">CHECKOUT</h2>
                        <button @click="showCheckout=false" class="brutal-btn px-4 py-2 text-sm brutal-btn-secondary">×</button>
                    </div>
                    
                    <!-- Order Summary -->
                    <div class="bg-black text-white p-4 mb-6 border-2 border-white">
                        <h3 class="brutal-mono text-sm brutal-accent-text mb-4">// ORDER SUMMARY</h3>
                        <template x-for="item in cart.items" :key="item.productId">
                            <div class="flex justify-between py-2 border-b border-gray-700 last:border-0 brutal-mono text-sm">
                                <span><span x-text="item.image"></span> <span x-text="item.name"></span> × <span x-text="item.quantity"></span></span>
                                <span class="brutal-accent-text" x-text="item.price*item.quantity"></span>₽
                            </div>
                        </template>
                        <div class="flex justify-between pt-4 mt-4 border-t-2 border-white font-bold text-xl brutal-title">
                            <span>TOTAL:</span><span class="brutal-accent-text" x-text="cart.total"></span>₽
                        </div>
                    </div>
                    
                    <form @submit.prevent="createPayment">
                        <div class="mb-4">
                            <label class="block brutal-mono text-sm mb-2 brutal-accent-text">// EMAIL</label>
                            <input type="email" x-model="checkoutForm.email" required placeholder="YOUR@EMAIL.COM" class="brutal-input w-full px-4 py-3 text-lg">
                        </div>
                        <div class="mb-6">
                            <label class="block brutal-mono text-sm mb-2 brutal-accent-text">// PHONE</label>
                            <input type="tel" x-model="checkoutForm.phone" placeholder="+7 (999) 999-99-99" class="brutal-input w-full px-4 py-3 text-lg">
                        </div>
                        <div x-show="error" class="bg-red-600 text-white p-3 mb-4 text-center brutal-mono border-2 border-black" x-text="error"></div>
                        <div class="flex gap-4">
                            <button type="button" @click="showCheckout=false" class="flex-1 brutal-btn brutal-btn-secondary py-4 text-xl" :disabled="loading">CANCEL</button>
                            <button type="submit" class="flex-1 brutal-btn py-4 text-xl" :disabled="loading">
                                <span x-show="!loading">PAY <span x-text="cart.total"></span>₽</span>
                                <span x-show="loading">PROCESSING...</span>
                            </button>
                        </div>
                    </form>
                    <div class="text-center brutal-mono text-xs mt-6 bg-black text-white p-3 border-2 border-white">
                        <p class="brutal-accent2-text">⚡ SECURE PAYMENT // ROBOKASSA</p>
                        <p>ALL MAJOR CARDS ACCEPTED</p>
                    </div>
                </div>
                <div class="brutal-barcode h-2"></div>
            </div>
        </div>

        <!-- Products Grid -->
        <div x-show="!showCheckout">
            <div class="brutal-stripe h-2 mb-8"></div>
            <h2 class="brutal-title text-5xl md:text-6xl text-center mb-2 brutal-accent-text">PRODUCTS</h2>
            <p class="brutal-mono text-center text-sm mb-8 text-gray-400">// CHOOSE YOUR WEAPON</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <template x-for="product in products" :key="product.id">
                    <div class="brutal-card p-6 brutal-noise">
                        <div class="bg-black h-48 flex items-center justify-center mb-4 border-2 border-black">
                            <span class="text-8xl" x-text="product.image"></span>
                        </div>
                        <div class="brutal-barcode h-1 mb-4"></div>
                        <h3 class="brutal-title text-3xl mb-2" x-text="product.name"></h3>
                        <p class="text-sm mb-4 brutal-mono" x-text="product.description"></p>
                        <div class="flex justify-between items-center mb-4">
                            <span class="brutal-title text-4xl brutal-accent-text" x-text="product.price"></span>
                            <span class="brutal-mono text-xs">₽</span>
                        </div>
                        <button @click="addToCart(product.id)" class="brutal-btn w-full py-4 text-xl">ADD TO CART</button>
                    </div>
                </template>
            </div>
        </div>
    </main>

    <!-- Cart Sidebar -->
    <div x-show="showCart&&!showCheckout" class="fixed inset-0 bg-black/80 z-[1000]" x-transition.opacity>
        <div class="absolute right-0 top-0 h-full w-full max-w-md bg-white cart-modal border-l-4 border-black">
            <div class="brutal-stripe h-3"></div>
            <div class="bg-black text-white p-5 flex justify-between items-center">
                <h2 class="brutal-title text-3xl">CART</h2>
                <button @click="showCart=false" class="brutal-btn px-4 py-2 text-sm brutal-btn-secondary">×</button>
            </div>
            <div class="flex-1 overflow-y-auto p-5 brutal-noise">
                <template x-if="cart.items.length===0">
                    <div class="text-center py-20">
                        <p class="brutal-title text-4xl mb-4 brutal-accent-text">EMPTY</p>
                        <p class="brutal-mono">NO GEAR SELECTED</p>
                    </div>
                </template>
                <template x-if="cart.items.length>0">
                    <div>
                        <div class="space-y-4">
                            <template x-for="item in cart.items" :key="item.productId">
                                <div class="bg-black text-white p-4 border-2 border-white">
                                    <div class="flex items-center gap-4">
                                        <div class="w-16 h-16 bg-white border-2 border-black flex items-center justify-center text-5xl" x-text="item.image"></div>
                                        <div class="flex-1">
                                            <h4 class="brutal-title text-xl" x-text="item.name"></h4>
                                            <p class="brutal-accent-text brutal-mono" x-text="item.price"></p>₽
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between mt-4 pt-4 border-t border-gray-700">
                                        <div class="flex items-center gap-2">
                                            <button @click="updateQuantity(item.productId,item.quantity-1)" class="brutal-btn px-3 py-2 text-sm brutal-btn-secondary">-</button>
                                            <span class="brutal-mono text-xl w-8 text-center" x-text="item.quantity"></span>
                                            <button @click="updateQuantity(item.productId,item.quantity+1)" class="brutal-btn px-3 py-2 text-sm brutal-btn-secondary">+</button>
                                        </div>
                                        <button @click="removeFromCart(item.productId)" class="brutal-btn px-3 py-2 text-sm brutal-btn-secondary">REMOVE</button>
                                    </div>
                                </div>
                            </template>
                        </div>
                        <div class="mt-6 pt-6 border-t-4 border-black bg-black text-white p-4">
                            <div class="flex justify-between items-center mb-4">
                                <span class="brutal-title text-2xl">TOTAL:</span>
                                <span class="brutal-title text-4xl brutal-accent-text" x-text="cart.total"></span>₽
                            </div>
                            <button @click="showCart=false;showCheckout=true" class="brutal-btn w-full py-4 text-xl">PROCEED TO CHECKOUT</button>
                        </div>
                    </div>
                </template>
            </div>
            <div class="brutal-barcode h-2"></div>
        </div>
    </div>

    <!-- Brutal Footer -->
    <footer class="bg-black border-t-4 border-white py-8 mt-auto">
        <div class="brutal-stripe h-2 mb-6"></div>
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="brutal-title text-2xl mb-2">IRON FORGE</p>
            <p class="brutal-mono text-xs text-gray-500">// © 2026 ALL RIGHTS RESERVED</p>
            <p class="brutal-mono text-xs brutal-accent-text mt-2">POWERED BY ROBOKASSA</p>
        </div>
        <div class="brutal-barcode h-2 mt-6"></div>
    </footer>

    <script>
        function happinessStore(){
            return{
                products:[],cart:{items:[],total:0},showCart:!1,showCheckout:!1,checkoutForm:{email:'',phone:''},loading:!1,error:'',paymentSuccess:null,
                sessionId:localStorage.getItem('sessionId')||'session-'+Date.now()+'-'+Math.random().toString(36).substr(2,9),
                init(){localStorage.setItem('sessionId',this.sessionId);this.fetchProducts();this.fetchCart();this.checkPaymentSuccess();},
                async fetchProducts(){const e=await fetch('/api/products');this.products=await e.json();},
                async fetchCart(){const e=await fetch('/api/cart/'+this.sessionId);this.cart=await e.json();},
                async addToCart(e){await fetch('/api/cart/'+this.sessionId+'/add',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({productId:e})});await this.fetchCart();},
                async removeFromCart(e){await fetch('/api/cart/'+this.sessionId+'/item/'+e,{method:'DELETE'});await this.fetchCart();},
                async updateQuantity(e,t){t<1?await this.removeFromCart(e):(await fetch('/api/cart/'+this.sessionId+'/item/'+e,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({productId:e,quantity:t})}),await this.fetchCart());},
                async createPayment(){this.loading=!0,this.error='';try{const e=await fetch('/api/payment/create',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({sessionId:this.sessionId,email:this.checkoutForm.email,phone:this.checkoutForm.phone})}),t=await e.json();e.ok?window.location.href=t.paymentUrl:(this.error=t.error||'Failed to create payment',this.loading=!1)}catch{this.error='Failed to create payment. Please try again.',this.loading=!1}},
                checkPaymentSuccess(){const e=new URLSearchParams(window.location.search);e.get('payment')==='success'&&(this.paymentSuccess={orderId:e.get('orderId'),amount:e.get('amount')},window.history.replaceState({},document.title,window.location.pathname))},
                get cartItemCount(){return this.cart.items.reduce((e,t)=>e+t.quantity,0)}
            }
        }
    </script>
</body>
</html>
